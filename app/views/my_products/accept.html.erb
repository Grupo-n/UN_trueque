
<% content_for :head do %>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAMML9mHoxFIC-3CKz_x2-bwQ2s92O4cmE"async defer></script>
  <script src="//cdn.rawgit.com/mahnunchik/markerclustererplus/master/dist/markerclusterer.min.js"></script>
  <script src='//cdn.rawgit.com/printercu/google-maps-utility-library-v3-read-only/master/infobox/src/infobox_packed.js' type='text/javascript'></script> <!-- only if you need custom infoboxes -->

  <% end %>


<div class="container margin-top">
  <h2 class="myhnot">Mapa</h2>
  <%= image_tag "http://maps.google.com/maps/api/staticmap?size=450x300&sensor=false&zoom=16&markers=#{@barter.latitude}%2C#{@barter.longitude}" %>
  <div class="panel-footer">
    <%= form_for @barter do |b| %>
      <h6><strong>Lugar del trueque: </strong></h6>
      <%= b.text_area :address, class: 'form-control', placeholder: 'Universidad Nacional de Colombia' %>
      <%= @product_one.available = false %>
      <%= @product_one.save %>

      <%= @product_two.available = false %>
      <%= @product_two.save %>
      <%= @barter.state = 2 %>
      <%= @barter.save%>

      <%= b.submit 'Aceptar', class: 'btn  btn-right' %>

    <% end %>
    <a class="ui teal button minibtn" href="facture.pdf">Descargar PDF</a>
    <%= link_to 'PDF' , @barter.id.to_s+".pdf", class:"minibtn" %>
    <%= link_to 'Edit PDF', edit_barter_path(@barter), class:"minibtn" %>
  </div>
</div>

<div style='width: 800px;'>
  <div id="map" style='width: 800px; height: 400px;'></div>
</div>


<script>
var mapStyle = [
 
 
  {
        "featureType": "all",
        "elementType": "labels.text.fill",
        "stylers": [
            {
                "color": "#ffffff"
            }
        ]
    },
    {
        "featureType": "all",
        "elementType": "labels.text.stroke",
        "stylers": [
            {
                "color": "#000000"
            },
            {
                "lightness": 13
            }
        ]
    },
    {
        "featureType": "administrative",
        "elementType": "geometry.fill",
        "stylers": [
            {
                "color": "#000000"
            }
        ]
    },
    {
        "featureType": "administrative",
        "elementType": "geometry.stroke",
        "stylers": [
            {
                "color": "#144b53"
            },
            {
                "lightness": 14
            },
            {
                "weight": 1.4
            }
        ]
    },
    {
        "featureType": "landscape",
        "elementType": "all",
        "stylers": [
            {
                "color": "#08304b"
            }
        ]
    },
    {
        "featureType": "poi",
        "elementType": "geometry",
        "stylers": [
            {
                "color": "#0c4152"
            },
            {
                "lightness": 5
            }
        ]
    },
    {
        "featureType": "road.highway",
        "elementType": "geometry.fill",
        "stylers": [
            {
                "color": "#000000"
            }
        ]
    },
    {
        "featureType": "road.highway",
        "elementType": "geometry.stroke",
        "stylers": [
            {
                "color": "#0b434f"
            },
            {
                "lightness": 25
            }
        ]
    },
    {
        "featureType": "road.arterial",
        "elementType": "geometry.fill",
        "stylers": [
            {
                "color": "#000000"
            }
        ]
    },
    {
        "featureType": "road.arterial",
        "elementType": "geometry.stroke",
        "stylers": [
            {
                "color": "#0b3d51"
            },
            {
                "lightness": 16
            }
        ]
    },
    {
        "featureType": "road.local",
        "elementType": "geometry",
        "stylers": [
            {
                "color": "#000000"
            }
        ]
    },
    {
        "featureType": "transit",
        "elementType": "all",
        "stylers": [
            {
                "color": "#146474"
            }
        ]
    },
    {
        "featureType": "water",
        "elementType": "all",
        "stylers": [
            {
                "color": "#021019"
            }
        ]
    }
    
 
];

var marker;
handler = Gmaps.build('Google');
handler.buildMap({ internal: {id: 'map'},
 provider: {
      zoom:      15,
      center:    new google.maps.LatLng(53.385873, -1.471471),
      mapTypeId: google.maps.MapTypeId.ROADMAP,
      styles:    mapStyle
    }
  
}, function(){
  if(navigator.geolocation)
    navigator.geolocation.getCurrentPosition(displayOnMap);
});

function displayOnMap(position){
  marker = handler.addMarker({
    lat: position.coords.latitude,
    lng: position.coords.longitude
  });
  handler.map.centerOn(marker);
};

google.maps.event.addListener(handler.getMap(), "click", function(evt) {
  handler.removeMarker(marker);
  marker = handler.addMarker({
    lat: evt.latLng.lat(),
    lng: evt.latLng.lng()
  });
  handler.map.centerOn(marker);
});






</script>